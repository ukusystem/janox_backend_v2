import{r as d,K as N,J as F,s as U,aX as rt,U as W,R as V,aY as ot,M as q,j as e,N as H,P as J,V as v,aZ as at,a_ as st,a as A,u as K,F as I,n as it,m as nt,L as lt,h as dt,i as ct,T as w,v as Q,w as X,l as C,B as m,O as Y,a$ as ut,e as pt,b0 as P,b1 as D,b2 as gt,b3 as E,b4 as ft,b5 as xt,G as mt,p as ht,H as $,q as bt}from"./index-B2MwQ28r.js";import{C as vt}from"./ControllerConnectIcon-Di1ptAq0.js";import{L as yt}from"./LockIcon-DqzgJcKs.js";import{S as Ct}from"./SpeedCameraIcon-DoAZ-uPr.js";import{L as Bt}from"./ListItemButton-Dybxl5ag.js";import{S as St}from"./StreamPlayer-D6eUqJhJ.js";function $t(t){return d.Children.toArray(t).filter(r=>d.isValidElement(r))}function jt(t){return N("MuiToggleButton",t)}const y=F("MuiToggleButton",["root","disabled","selected","standard","primary","secondary","sizeSmall","sizeMedium","sizeLarge","fullWidth"]),Z=d.createContext({}),tt=d.createContext(void 0);function Rt(t,r){return r===void 0||t===void 0?!1:Array.isArray(r)?r.includes(t):t===r}const Tt=t=>{const{classes:r,fullWidth:o,selected:a,disabled:s,size:f,color:n}=t,g={root:["root",a&&"selected",s&&"disabled",o&&"fullWidth",`size${W(f)}`,n]};return J(g,jt,r)},kt=U(rt,{name:"MuiToggleButton",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:o}=t;return[r.root,r[`size${W(o.size)}`]]}})(V(({theme:t})=>({...t.typography.button,borderRadius:(t.vars||t).shape.borderRadius,padding:11,border:`1px solid ${(t.vars||t).palette.divider}`,color:(t.vars||t).palette.action.active,[`&.${y.disabled}`]:{color:(t.vars||t).palette.action.disabled,border:`1px solid ${(t.vars||t).palette.action.disabledBackground}`},"&:hover":{textDecoration:"none",backgroundColor:t.vars?`rgba(${t.vars.palette.text.primaryChannel} / ${t.vars.palette.action.hoverOpacity})`:v(t.palette.text.primary,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},variants:[{props:{color:"standard"},style:{[`&.${y.selected}`]:{color:(t.vars||t).palette.text.primary,backgroundColor:t.vars?`rgba(${t.vars.palette.text.primaryChannel} / ${t.vars.palette.action.selectedOpacity})`:v(t.palette.text.primary,t.palette.action.selectedOpacity),"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.text.primaryChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:v(t.palette.text.primary,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:t.vars?`rgba(${t.vars.palette.text.primaryChannel} / ${t.vars.palette.action.selectedOpacity})`:v(t.palette.text.primary,t.palette.action.selectedOpacity)}}}}},...Object.entries(t.palette).filter(at()).map(([r])=>({props:{color:r},style:{[`&.${y.selected}`]:{color:(t.vars||t).palette[r].main,backgroundColor:t.vars?`rgba(${t.vars.palette[r].mainChannel} / ${t.vars.palette.action.selectedOpacity})`:v(t.palette[r].main,t.palette.action.selectedOpacity),"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette[r].mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:v(t.palette[r].main,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:t.vars?`rgba(${t.vars.palette[r].mainChannel} / ${t.vars.palette.action.selectedOpacity})`:v(t.palette[r].main,t.palette.action.selectedOpacity)}}}}})),{props:{fullWidth:!0},style:{width:"100%"}},{props:{size:"small"},style:{padding:7,fontSize:t.typography.pxToRem(13)}},{props:{size:"large"},style:{padding:15,fontSize:t.typography.pxToRem(15)}}]}))),wt=d.forwardRef(function(r,o){const{value:a,...s}=d.useContext(Z),f=d.useContext(tt),n=ot({...s,selected:Rt(r.value,a)},r),g=q({props:n,name:"MuiToggleButton"}),{children:h,className:i,color:c="standard",disabled:_=!1,disableFocusRipple:B=!1,fullWidth:p=!1,onChange:j,onClick:R,selected:b,size:L="medium",value:S,...z}=g,T={...g,color:c,disabled:_,disableFocusRipple:B,fullWidth:p,size:L},M=Tt(T),G=u=>{R&&(R(u,S),u.defaultPrevented)||j&&j(u,S)},x=f||"";return e.jsx(kt,{className:H(s.className,M.root,i,x),disabled:_,focusRipple:!B,ref:o,onClick:G,onChange:j,value:S,ownerState:T,"aria-pressed":b,...z,children:h})});function _t(t){return N("MuiToggleButtonGroup",t)}const l=F("MuiToggleButtonGroup",["root","selected","horizontal","vertical","disabled","grouped","groupedHorizontal","groupedVertical","fullWidth","firstButton","lastButton","middleButton"]),Lt=t=>{const{classes:r,orientation:o,fullWidth:a,disabled:s}=t,f={root:["root",o,a&&"fullWidth"],grouped:["grouped",`grouped${W(o)}`,s&&"disabled"],firstButton:["firstButton"],lastButton:["lastButton"],middleButton:["middleButton"]};return J(f,_t,r)},Ot=U("div",{name:"MuiToggleButtonGroup",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:o}=t;return[{[`& .${l.grouped}`]:r.grouped},{[`& .${l.grouped}`]:r[`grouped${W(o.orientation)}`]},{[`& .${l.firstButton}`]:r.firstButton},{[`& .${l.lastButton}`]:r.lastButton},{[`& .${l.middleButton}`]:r.middleButton},r.root,o.orientation==="vertical"&&r.vertical,o.fullWidth&&r.fullWidth]}})(V(({theme:t})=>({display:"inline-flex",borderRadius:(t.vars||t).shape.borderRadius,variants:[{props:{orientation:"vertical"},style:{flexDirection:"column",[`& .${l.grouped}`]:{[`&.${l.selected} + .${l.grouped}.${l.selected}`]:{borderTop:0,marginTop:0}},[`& .${l.firstButton},& .${l.middleButton}`]:{borderBottomLeftRadius:0,borderBottomRightRadius:0},[`& .${l.lastButton},& .${l.middleButton}`]:{marginTop:-1,borderTop:"1px solid transparent",borderTopLeftRadius:0,borderTopRightRadius:0},[`& .${l.lastButton}.${y.disabled},& .${l.middleButton}.${y.disabled}`]:{borderTop:"1px solid transparent"}}},{props:{fullWidth:!0},style:{width:"100%"}},{props:{orientation:"horizontal"},style:{[`& .${l.grouped}`]:{[`&.${l.selected} + .${l.grouped}.${l.selected}`]:{borderLeft:0,marginLeft:0}},[`& .${l.firstButton},& .${l.middleButton}`]:{borderTopRightRadius:0,borderBottomRightRadius:0},[`& .${l.lastButton},& .${l.middleButton}`]:{marginLeft:-1,borderLeft:"1px solid transparent",borderTopLeftRadius:0,borderBottomLeftRadius:0},[`& .${l.lastButton}.${y.disabled},& .${l.middleButton}.${y.disabled}`]:{borderLeft:"1px solid transparent"}}}]}))),Wt=d.forwardRef(function(r,o){const a=q({props:r,name:"MuiToggleButtonGroup"}),{children:s,className:f,color:n="standard",disabled:g=!1,exclusive:h=!1,fullWidth:i=!1,onChange:c,orientation:_="horizontal",size:B="medium",value:p,...j}=a,R={...a,disabled:g,fullWidth:i,orientation:_,size:B},b=Lt(R),L=d.useCallback((x,u)=>{if(!c)return;const k=p&&p.indexOf(u);let O;p&&k>=0?(O=p.slice(),O.splice(k,1)):O=p?p.concat(u):[u],c(x,O)},[c,p]),S=d.useCallback((x,u)=>{c&&c(x,p===u?null:u)},[c,p]),z=d.useMemo(()=>({className:b.grouped,onChange:h?S:L,value:p,size:B,fullWidth:i,color:n,disabled:g}),[b.grouped,h,S,L,p,B,i,n,g]),T=$t(s),M=T.length,G=x=>{const u=x===0,k=x===M-1;return u&&k?"":u?b.firstButton:k?b.lastButton:b.middleButton};return e.jsx(Ot,{role:"group",className:H(b.root,f),ref:o,ownerState:R,...j,children:e.jsx(Z.Provider,{value:z,children:T.map((x,u)=>e.jsx(tt.Provider,{value:G(u),children:x},u))})})}),zt=({ctrl_id:t})=>{const{isSuccess:r,data:o}=st({ctrl_id:t},{refetchOnMountOrArgChange:!0}),a=A(n=>n.streamStore),s=K(),f=n=>{n!==null&&s(I({camera_site:{ctrl_id:t,cmr_id:n.cmr_id,tc_id:n.tc_id,descripcion:n.descripcion}}))};return d.useEffect(()=>{if(r&&o&&a.camera_site===void 0){const n=o[0];n&&s(I({camera_site:{ctrl_id:t,cmr_id:n.cmr_id,tc_id:n.tc_id,descripcion:n.descripcion}}))}},[r,o]),e.jsx(it,{sx:{maxWidth:"100%",maxHeight:"100%"},children:e.jsx(nt,{children:r&&o&&o.map((n,g)=>{var i,c;const h=((i=a.camera_site)==null?void 0:i.cmr_id)===n.cmr_id&&((c=a.camera_site)==null?void 0:c.ctrl_id)===t;return e.jsx(lt,{disablePadding:!0,children:e.jsxs(Bt,{onClick:()=>{f(n)},selected:h,sx:{minHeight:48,color:"text.primary","&:hover":{backgroundColor:"custom.trackBackground"},"&.Mui-selected":{backgroundColor:"tertiary.opacityMain",color:"text.primary","&:hover":{backgroundColor:"tertiary.opacityMain"}},justifyContent:"initial"},children:[e.jsx(dt,{sx:{minWidth:40},children:e.jsx(Ct,{sx:{width:24,height:"auto",color:"text.primary"}})}),e.jsx(ct,{sx:{overflow:"hidden"},primary:e.jsx(w,{variant:"body1",sx:{overflow:"hidden",width:"100%",textWrap:"nowrap",textOverflow:"ellipsis"},children:n.descripcion})})]})},g)})})})},Mt=({ctrl_id:t})=>{const[r,o]=d.useState(null),a=d.useRef(null);return d.useEffect(()=>(a.current||(a.current=Q(`${X}/last_snapshot/${t}`,{withCredentials:!0})),a.current.on("last_snapshot",s=>{o(s)}),()=>{a.current&&(a.current.disconnect(),a.current=null)}),[t]),e.jsx(e.Fragment,{children:e.jsxs(C,{spacing:1,height:"100%",children:[e.jsx(w,{variant:"h5",color:"textPrimary",sx:{px:1,py:.5},children:"Última foto"}),e.jsxs(C,{flex:1,children:[r!==null&&e.jsx(m,{component:"img",sx:{height:"100%",width:"100%",objectFit:"contain"},src:r}),r===null&&e.jsx(C,{width:"100%",height:"100%",alignItems:"center",justifyContent:"center",children:e.jsx(w,{variant:"body1",textAlign:"center",sx:{textWrap:"pretty"},children:"Captura no disponible."})})]})]})})},Gt=()=>{const{camera_site:t}=A(r=>r.streamStore);return e.jsx(e.Fragment,{children:e.jsxs(m,{sx:{width:"100%",height:"100%",position:"relative"},children:[t&&e.jsx(e.Fragment,{children:e.jsx(St,{ctrl_id:t.ctrl_id,cmr_id:t.cmr_id,q:"q1",isContain:!0},t.ctrl_id+t.cmr_id+"q1")}),!t&&e.jsx(C,{width:"100%",height:"100%",alignItems:"center",justifyContent:"center",children:e.jsx(w,{variant:"body1",children:"Seleciona una camara."})})]})})},At=({ctrl_id:t})=>e.jsxs(m,{sx:{display:"grid",gridTemplateColumns:"250px auto 300px",gridTemplateRows:"repeat(5, 1fr)",gridColumnGap:"0px",gridRowGap:"0px",height:"100%",width:"100%",color:"white"},children:[e.jsx(m,{sx:{gridArea:"1 / 1 / 4 / 2",borderBottomWidth:1,borderBottomStyle:"solid",borderBottomColor:"divider",borderRightWidth:1,borderRightStyle:"solid",borderRightColor:"divider"},children:e.jsx(zt,{ctrl_id:t})}),e.jsx(m,{sx:{gridArea:"4 / 1 / 6 / 2",borderRightWidth:1,borderRightStyle:"solid",borderRightColor:"divider"},children:e.jsx(Mt,{ctrl_id:t})}),e.jsx(m,{sx:{gridArea:"1 / 2 / 6 / 3"},children:e.jsx(Gt,{})}),e.jsx(m,{sx:{gridArea:"1 / 3 / 6 / 4",borderLeftWidth:1,borderLeftStyle:"solid",borderLeftColor:"divider"},children:e.jsx(Y,{})})]}),et=[{value:"cameras",name:"Cámaras"},{value:"tickets",name:"Tickets"},{value:"alarms",name:"Alarmas"},{value:"controls",name:"Controles"},{value:"access",name:"Accesos"},{value:"temperature-energy",name:"Temperatura y energía"}],It=t=>{const r=t.match(/^\/site\/[^/]+\/([^/]+)(?:\/.*)?$/);if(!r)return[!1,""];const o=r[1],a=et.some(s=>s.value===o);return a?[a,o]:[!1,""]},Vt=()=>{const{ctrl_id:t}=ut(),{pathname:r}=pt(),o=d.useRef(null),a=K(),s=A(i=>i.controllerSiteState),f=()=>{o.current&&s.controller&&(s.controller.seguridad===$.Armado?o.current.emit("setSecurity",$.Desarmado):o.current.emit("setSecurity",$.Armado))},[n,g]=d.useState(It(r)[1]),h=(i,c)=>{c&&g(c)};return d.useEffect(()=>(t!==void 0&&(o.current||(o.current=Q(`${X}/controller_state/${t}`,{withCredentials:!0})),o.current.on("controller_info",i=>{a(P(i)),a(D(i.disableSecurityButton))}),o.current.on("update_region",i=>{a(gt(i))}),o.current.on("update_controller",i=>{a(P(i))}),o.current.on("update_security_button",i=>{a(D(i))}),o.current.on("error_message",i=>{a(E(i.message))}),o.current.on("connect",()=>{a(ft())}),o.current.on("connect_error",i=>{a(E(`Socket connect error: ${i.message}`))})),()=>{o.current&&(o.current.disconnect(),o.current=null),a(xt())}),[t]),e.jsxs(m,{sx:{width:"100%",height:"100%",overflow:"hidden"},children:[s.isError&&e.jsx("div",{children:s.error??"Ocurrio un error al obtener el controlador"}),s.isSuccess&&s.controller!==void 0&&e.jsxs(m,{sx:{maxWidth:1600,width:"100%",height:"100%",overflow:"hidden",mx:"auto",p:{xs:2,sm:3},display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(C,{direction:"row",spacing:1,justifyContent:"space-between",alignItems:"center",children:[e.jsxs(C,{direction:"row",spacing:3,alignItems:"center",justifyContent:"center",children:[e.jsxs(C,{direction:"row",spacing:1,alignItems:"center",justifyContent:"center",children:[e.jsx(vt,{isConnect:s.controller.conectado===1,sx:{width:40,height:"auto"}}),e.jsx(w,{variant:"h5",sx:{textWrap:"nowrap"},children:s.controller.nodo})]}),s.controller.modo===mt.Seguridad&&e.jsx(ht,{variant:"label",fullWidth:!0,color:s.controller.seguridad===$.Armado?"tertiary":"warning",size:"medium",onClick:f,disabled:s.isDisabledSecurityButton===void 0?!0:s.isDisabledSecurityButton,startIcon:e.jsx(yt,{isOpen:s.controller.seguridad===$.Desarmado}),children:s.controller.seguridad===$.Armado?"Armado":"Desarmado"})]}),e.jsx(Wt,{color:"primary",value:n,exclusive:!0,onChange:h,"aria-label":"Platform",sx:{"& .MuiToggleButton-root":{borderWidth:1,borderStyle:"solid",borderColor:"tertiary.main",color:"text.primary",fontWeight:"bold",textTransform:"none","&:hover":{backgroundColor:"tertiary.opacityLight"},"&.Mui-selected":{backgroundColor:"tertiary.opacityDark",color:"text.primary","&:hover":{backgroundColor:"tertiary.opacityDark"}},"&:not(:last-of-type)":{borderRight:"none"},"&:first-of-type":{borderTopLeftRadius:"12px",borderBottomLeftRadius:"12px"},"&:last-of-type":{borderTopRightRadius:"12px",borderBottomRightRadius:"12px"}}},children:et.map((i,c)=>e.jsx(wt,{value:i.value,component:bt,to:`/site/${t}/${i.value}`,sx:{whiteSpace:"nowrap"},children:i.name},c))})]}),e.jsxs(m,{sx:{flexGrow:1,overflow:"hidden",borderRadius:"8px",borderWidth:1,borderStyle:"solid",borderColor:"divider",backgroundColor:"background.paper"},children:[n!=="tickets"&&e.jsx(At,{ctrl_id:s.controller.ctrl_id}),n==="tickets"&&e.jsx(Y,{})]})]})]})};export{Vt as default};
