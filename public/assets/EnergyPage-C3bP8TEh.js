import{s as _,ax as v,r as p,j as e,l as w,T as M,ay as T,az as k,aA as R,aB as S,aC as x,aD as P,aF as b,a as A,v as z,w as F,n as I,dh as O}from"./index-B2MwQ28r.js";import{S as W,P as B,F as V}from"./PageService-BmPU0Ixz.js";import"./Card-Czpwx8nj.js";import"./CardHeader--yi8JTB-.js";import"./CardContent-CM-ZmfFR.js";import"./Clear-CXgFz3fp.js";import"./SearchIcon-CAoQ-mMC.js";import"./groupByKey-nGMiMvM1.js";import"./Autocomplete-DO-HpUXO.js";import"./usePreviousProps-DjccIP3f.js";const H=({data:s,socket:i,ctrl_id:g})=>{const[u,f]=p.useState(s);return p.useEffect(()=>{i.current&&i.current.on("energy",(j,a,d)=>{switch(d){case"update":g===j&&u.me_id===a.me_id&&f(a);break}})},[i]),e.jsx(e.Fragment,{children:e.jsxs(w,{spacing:1,children:[e.jsx(M,{variant:"subtitle1",color:"textPrimary",sx:{overflow:"hidden",textWrap:"nowrap",textOverflow:"ellipsis"},children:u.descripcion}),e.jsx(T,{component:G,children:e.jsxs(k,{"aria-label":"simple table",size:"small",sx:{"& .MuiTableCell-root":{borderColor:"transparent"}},children:[e.jsx(R,{sx:{backgroundColor:"action.hover"},children:e.jsxs(S,{children:[e.jsx(x,{children:"AMP(A)"}),e.jsx(x,{children:"VOLT(V)"}),e.jsx(x,{children:"POT(W)"}),e.jsx(x,{children:"KWH"})]})}),e.jsx(P,{children:e.jsxs(S,{children:[e.jsx(x,{children:u.amperaje??"*"}),e.jsx(x,{children:u.voltaje??"*"}),e.jsx(x,{children:u.potenciaw??"*"}),e.jsx(x,{children:u.potenciakwh??"*"})]})})]})})]})})},G=_(v)(({theme:s})=>({borderRadius:8,borderWidth:1,borderStyle:"solid",borderColor:s.palette.divider,backgroundColor:s.palette.background.paper,backgroundImage:"none",boxShadow:"none",color:s.palette.text.primary})),K=({data:s,socket:i})=>{const[g,u]=p.useState(s.controlador),[f,j]=p.useState(s.energy);return p.useEffect(()=>{i.current&&(i.current.on("energy",(a,d,c)=>{switch(c){case"add":g.ctrl_id===a&&j(r=>{const t=new Map(r);return t.set(d.me_id,d),t});break;case"delete":g.ctrl_id===a&&j(r=>{const t=new Map(r);return t.delete(d.me_id),t});break}}),i.current.on("controller",(a,d,c)=>{switch(c){case"update":g.ctrl_id===a&&u(d);break}}))},[i]),e.jsx(W,{title:g.nodo,children:e.jsx(w,{spacing:2,children:f.size>0&&e.jsx(b,{size:{xs:12},container:!0,rowSpacing:1,columnSpacing:2,width:"100%",marginTop:1,children:Array.from(f).map(([a,d])=>e.jsx(b,{size:{xs:12},children:e.jsx(H,{data:d,socket:i,ctrl_id:g.ctrl_id})},a))})})})},L=()=>{const{rgn_id:s,ctrl_id:i,state:g}=A(r=>r.energyServiceStore),[u,f]=p.useState(new Map),[j,a]=p.useState(new Map),d=p.useMemo(()=>{const r=new Map;for(const[,l]of j){const n=l.controlador.rgn_id,o=l.controlador.ctrl_id;if(s!==void 0&&String(n)!==String(s)||i!==void 0&&String(o)!==String(i))continue;const h=r.get(n);h===void 0?r.set(n,[l]):h.push(l)}return Array.from(r.values()).reduce((l,n)=>{const o=l,h=n;if(h[0]){const m=u.get(h[0].controlador.rgn_id);m!==void 0&&o.push({rgn_id:m.rgn_id,region:m.region,nodos:r.get(m.rgn_id)??[]})}return o},[])},[j,s,i,g]),c=p.useRef(null);return p.useEffect(()=>(c.current||(c.current=z(`${F}/energy`,{withCredentials:!0})),c.current.on("initial_data",(r,t)=>{const l=new Map;t.forEach(o=>{l.set(o.rgn_id,o)}),f(l);const n=new Map;Object.values(r).forEach(o=>{const{controlador:h,module_energy:m}=o,E=m.map(y=>[y.me_id,y]),C={controlador:h,energy:new Map(E)};n.set(h.ctrl_id,C)}),a(n)}),c.current.on("region",(r,t)=>{f(l=>{const n=new Map(l);return n.set(r,t),n})}),c.current.on("controller",(r,t,l)=>{switch(l){case"add":a(n=>{if(!n.has(r)){const o=new Map([...n]);return o.set(r,{controlador:t,energy:new Map}),o}return n});break;case"delete":a(n=>{if(n.has(r)){const o=new Map([...n]);return o.delete(r),o}return n});break}}),()=>{c.current&&(c.current.disconnect(),c.current=null)}),[]),e.jsx(w,{spacing:2,overflow:"hidden",children:d.map(r=>e.jsxs(w,{overflow:"hidden",children:[e.jsx(M,{variant:"h5",children:r.region}),e.jsx(I,{sx:{width:"100%",height:"100%"},children:e.jsx(w,{spacing:2,direction:"row",py:2,children:r.nodos.map(t=>e.jsx(K,{data:t,socket:c},t.controlador.ctrl_id))})})]},r.rgn_id))})},ee=()=>e.jsx(B,{title:"EnergÃ­a",filter:e.jsx(V,{storeSelector:s=>s.energyServiceStore,updateStoreAction:O}),children:e.jsx(L,{})});export{ee as default};
