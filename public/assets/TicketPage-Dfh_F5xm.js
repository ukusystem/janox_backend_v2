import{u as G,a as D,a6 as T,f as K,e as X,j as e,B as y,n as L,l as c,bR as g,E as q,a9 as _,a5 as A,aa as M,ab as P,ac as m,aJ as Z,i as H,bS as V,a8 as Y,p as ee,bT as re,bU as te,bV as oe,s as ie,ax as ne,r as b,bW as ae,ay as se,az as de,aA as le,aB as ce,aC as j,aD as ue,bX as pe,bY as he,T as F,m as ge,D as xe}from"./index-B2MwQ28r.js";import{g as w}from"./groupByKey-nGMiMvM1.js";import{S as me}from"./SearchIcon-CAoQ-mMC.js";import{C as be}from"./Clear-CXgFz3fp.js";import{A as fe}from"./Autocomplete-DO-HpUXO.js";import{A as je,a as Ce,C as ye}from"./ArrowDropUp-DpvEkpl6.js";import{L as ke}from"./ListItemButton-Dybxl5ag.js";import"./usePreviousProps-DjccIP3f.js";var B=(r=>(r[r.Alta=1]="Alta",r[r.Media=2]="Media",r[r.Baja=3]="Baja",r))(B||{}),s=(r=>(r[r.Esperando=1]="Esperando",r[r.Aceptado=2]="Aceptado",r[r.Cancelado=3]="Cancelado",r[r.Rechazado=4]="Rechazado",r[r.Finalizado=16]="Finalizado",r[r.Anulado=17]="Anulado",r[r.NoAtendido=18]="NoAtendido",r[r.Asistido=21]="Asistido",r[r.Inasistencia=22]="Inasistencia",r))(s||{});const O=[{value:B.Alta,name:"Alta"},{value:B.Media,name:"Media"},{value:B.Baja,name:"Baja"}],W=[{value:s.Esperando,name:"Pendientes"},{value:s.Aceptado,name:"Aceptados"},{value:s.Cancelado,name:"Cancelados"},{value:s.Rechazado,name:"Rechazados"},{value:s.Finalizado,name:"Finalizados"},{value:s.Anulado,name:"Anulados"},{value:s.NoAtendido,name:"No atendido"},{value:s.Asistido,name:"Asistidos"},{value:s.Inasistencia,name:"No Asistidos"}],we=()=>{const r=G(),{rgn_id:o,ctrl_id:l,date:a,states:u,priority:p,controllerSearch:x}=D(t=>t.ticketStore),f=D(t=>t.authStore),{isSuccess:n,data:d,isLoading:v}=T(),E=K(),I=X(),k=()=>{var t;E(((t=f.user)==null?void 0:t.rl_id)===oe.Invitado?"/invitado/ticket/create":"/ticket/create",{state:{from:I.pathname}})},h=t=>{r(g({rgn_id:t.target.value,ctrl_id:void 0}))},R=t=>{r(g({ctrl_id:t.target.value}))},U=t=>{r(g({priority:t.target.value}))},Q=t=>{typeof t.target.value=="object"&&r(g({states:[...t.target.value]}))};return e.jsx(e.Fragment,{children:e.jsx(y,{sx:{width:"100%"},children:e.jsx(L,{sx:{maxWidth:"100%",height:"100%"},children:e.jsxs(c,{direction:"row",spacing:1,alignItems:"center",justifyContent:"space-between",paddingBottom:1.5,children:[e.jsxs(c,{direction:"row",spacing:1,alignItems:"center",height:"auto",children:[e.jsx(c,{spacing:2,sx:{width:250},children:e.jsx(fe,{freeSolo:!0,value:x,onChange:(t,i)=>{typeof i!="string"&&r(g({controllerSearch:i,rgn_id:i?String(i.rgn_id):void 0,ctrl_id:i?String(i.ctrl_id):void 0}))},clearIcon:e.jsx(be,{onClick:()=>{r(g({controllerSearch:null}))}}),id:"controller_ticket_searcher",options:n&&d?d:[],getOptionLabel:t=>typeof t=="string"?t:t.nodo,sx:{width:250},renderInput:t=>e.jsx(q,{...t,placeholder:"Buscar sitio",disabled:v,slotProps:{input:{...t.InputProps,startAdornment:e.jsx(me,{})}},sx:{"& .MuiOutlinedInput-root":{borderRadius:"25px",px:2}}})})}),e.jsxs(c,{spacing:1,width:200,direction:"row",alignItems:"center",children:[e.jsx(_,{htmlFor:"group_site",sx:{display:"none"},children:"Grupo de sitio"}),e.jsxs(A,{displayEmpty:!0,value:o??"",onChange:h,inputProps:{id:"group_site"},renderValue:t=>{if(t.length===0)return e.jsx(e.Fragment,{children:"Grupo de sitio"});let i;return n&&(i=w(d,"rgn_id")[t]?w(d,"rgn_id")[t][0]:void 0),e.jsx(e.Fragment,{children:i==null?void 0:i.region.region})},IconComponent:({...t})=>o?e.jsx(M,{onClick:i=>{i.stopPropagation(),r(g({rgn_id:void 0,ctrl_id:void 0}))}}):e.jsx(P,{...t}),sx:{width:200,borderRadius:"10px",backgroundColor:"transparent","&.Mui-focused":{boxShadow:"none"},"&.MuiOutlinedInput-root":{fontWeight:500,backgroundColor:"transparent",color:"text.primary","& fieldset":{...o&&{backgroundColor:"tertiary.opacityLight"},borderColor:"custom.outlineBoder"},"&:hover fieldset":{backgroundColor:"tertiary.opacityLight",borderColor:"custom.outlineBoder"},"&.Mui-focused fieldset":{borderColor:"custom.outlineBoder",backgroundColor:"tertiary.opacityLight"}},"& .MuiSelect-icon":{color:"text.primary"}},MenuProps:{PaperProps:{style:{maxHeight:200,width:200}}},children:[e.jsx(m,{disabled:!0,value:"",children:e.jsx(e.Fragment,{children:"Grupo de sitio"})}),n&&Object.entries(w(d,"rgn_id")).map(([t,i])=>e.jsx(m,{value:t,children:e.jsx(y,{sx:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",width:"100%"},children:i[0].region.region})},t))]})]}),e.jsxs(c,{spacing:1,width:200,direction:"row",alignItems:"center",children:[e.jsx(_,{htmlFor:"site_item",sx:{display:"none"},children:"Sitio"}),e.jsxs(A,{disabled:!o,displayEmpty:!0,value:l??"",onChange:R,inputProps:{id:"site_item"},renderValue:t=>{if(t.length===0)return e.jsx(e.Fragment,{children:"Sitio"});let i;return n&&(i=d.find(S=>String(S.ctrl_id)===String(t))),e.jsx(e.Fragment,{children:i==null?void 0:i.nodo})},IconComponent:({...t})=>l?e.jsx(M,{onClick:i=>{i.stopPropagation(),r(g({ctrl_id:void 0}))}}):e.jsx(P,{...t}),sx:{width:200,borderRadius:"10px",backgroundColor:"transparent","&.Mui-focused":{boxShadow:"none"},"&.MuiOutlinedInput-root":{fontWeight:500,backgroundColor:"transparent",color:"text.primary","& fieldset":{...o&&{backgroundColor:"tertiary.opacityLight"},borderColor:"custom.outlineBoder"},"&:hover fieldset":{backgroundColor:"tertiary.opacityLight",borderColor:"custom.outlineBoder"},"&.Mui-focused fieldset":{borderColor:"custom.outlineBoder",backgroundColor:"tertiary.opacityLight"}},"& .MuiSelect-icon":{color:"text.primary"}},MenuProps:{PaperProps:{style:{maxHeight:200,width:200}}},children:[e.jsx(m,{disabled:!0,value:"",children:e.jsx(e.Fragment,{children:"Sitio"})}),n&&o&&w(d,"rgn_id")[o]&&w(d,"rgn_id")[o].map(t=>e.jsx(m,{value:String(t.ctrl_id),children:e.jsx(y,{sx:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",width:"100%"},children:t.nodo})},String(t.ctrl_id)))]})]}),e.jsxs(c,{spacing:1,width:200,direction:"row",alignItems:"center",children:[e.jsx(_,{htmlFor:"multiple_state_select",sx:{display:"none"},children:"Estados"}),e.jsxs(A,{displayEmpty:!0,value:u,multiple:!0,onChange:Q,inputProps:{id:"multiple_state_select"},renderValue:t=>{if(t.length===0)return e.jsx(e.Fragment,{children:"Estados"});const i=t.reduce((S,$)=>{const z=S,N=W.find(J=>String(J.value)===String($));return N&&z.push(N.name),z},[]);return e.jsx(e.Fragment,{children:i.join(", ")})},IconComponent:({...t})=>u.length>0?e.jsx(M,{onClick:i=>{i.stopPropagation(),r(g({states:[]}))}}):e.jsx(P,{...t}),sx:{width:200,borderRadius:"10px",backgroundColor:"transparent","&.Mui-focused":{boxShadow:"none"},"&.MuiOutlinedInput-root":{fontWeight:500,backgroundColor:"transparent",color:"text.primary","& fieldset":{...u.length>0&&{backgroundColor:"tertiary.opacityLight"},borderColor:"custom.outlineBoder"},"&:hover fieldset":{backgroundColor:"tertiary.opacityLight",borderColor:"custom.outlineBoder"},"&.Mui-focused fieldset":{borderColor:"custom.outlineBoder",backgroundColor:"tertiary.opacityLight"}},"& .MuiSelect-icon":{color:"text.primary"}},MenuProps:{PaperProps:{style:{maxHeight:400,width:200}}},children:[e.jsx(m,{disabled:!0,value:"",children:e.jsx(e.Fragment,{children:"Estados"})}),W.map((t,i)=>e.jsxs(m,{value:String(t.value),children:[e.jsx(Z,{checked:u.includes(String(t.value))}),e.jsx(H,{primary:t.name})]},i))]})]}),e.jsxs(c,{spacing:1,width:200,direction:"row",alignItems:"center",children:[e.jsx(_,{htmlFor:"priority_select",sx:{display:"none"},children:"Prioridad"}),e.jsxs(A,{displayEmpty:!0,value:p??"",onChange:U,inputProps:{id:"priority_select"},renderValue:t=>{if(t.length===0)return e.jsx(e.Fragment,{children:"Nivel de prioridad"});const i=O.find(S=>String(S.value)===String(t));return e.jsx(e.Fragment,{children:i?i.name:"No controlado"})},IconComponent:({...t})=>p?e.jsx(M,{onClick:i=>{i.stopPropagation(),r(g({priority:void 0}))}}):e.jsx(P,{...t}),sx:{width:200,borderRadius:"10px",backgroundColor:"transparent","&.Mui-focused":{boxShadow:"none"},"&.MuiOutlinedInput-root":{fontWeight:500,backgroundColor:"transparent",color:"text.primary","& fieldset":{...p&&{backgroundColor:"tertiary.opacityLight"},borderColor:"custom.outlineBoder"},"&:hover fieldset":{backgroundColor:"tertiary.opacityLight",borderColor:"custom.outlineBoder"},"&.Mui-focused fieldset":{borderColor:"custom.outlineBoder",backgroundColor:"tertiary.opacityLight"}},"& .MuiSelect-icon":{color:"text.primary"}},MenuProps:{PaperProps:{style:{maxHeight:200,width:200}}},children:[e.jsx(m,{disabled:!0,value:"",children:e.jsx(e.Fragment,{children:"Nivel de prioridad"})}),O.map((t,i)=>e.jsx(m,{value:t.value,children:t.name},i))]})]}),e.jsxs(c,{spacing:1,width:200,direction:"row",alignItems:"center",children:[e.jsx(_,{htmlFor:"date-select-ticket",sx:{display:"none"},children:"Fecha"}),e.jsx(V,{format:"DD/MM/YYYY",value:a?Y(a,"DD/MM/YYYY"):null,onChange:t=>{t&&r(g({date:t.format("DD/MM/YYYY")}))},slots:{inputAdornment:ve},slotProps:{textField:{size:"medium",id:"date-select-ticket"},inputAdornment:{canDelete:!!a}}})]})]}),e.jsx(ee,{variant:"contained",color:"primary",size:"medium",startIcon:e.jsx(re,{}),onClick:k,sx:{minWidth:140,whiteSpace:"nowrap"},children:"Crear ticket"})]})})})})};function ve(r){const{canDelete:o,children:l,sx:a,...u}=r,p=G();return e.jsxs(te,{...u,children:[o&&e.jsx(M,{onClick:x=>{x.stopPropagation(),p(g({date:void 0}))}}),!o&&l]})}const Se=({controlador:{ctrl_id:r}})=>{const[o,l]=b.useState(0),[a,u]=b.useState(10),{date:p,states:x,priority:f}=D(h=>h.ticketStore),n=h=>{u(h.target.value),l(0)},d=(h,R)=>{l(R)},[v,{isError:E,isSuccess:I,data:k}]=ae();return b.useEffect(()=>{const h={};x.length>0&&(h.state=x),p!==void 0&&(h.dateRange={end:Y(p,"DD/MM/YYYY").format("YYYY-MM-DD"),start:Y(p,"DD/MM/YYYY").format("YYYY-MM-DD")}),f!==void 0&&(h.priority=f),v({ctrl_id:r,limit:a,offset:o*a,filters:h},!1)},[r,o,a,p,f,x]),e.jsxs(e.Fragment,{children:[e.jsx(se,{component:_e,children:e.jsxs(de,{"aria-label":"simple table",size:"small",sx:h=>({"& .MuiTableCell-root":{borderColor:"divider"},"& tbody tr:hover":{backgroundColor:"tertiary.opacityLight"}}),children:[e.jsx(le,{sx:{backgroundColor:"action.hover"},children:e.jsxs(ce,{children:[e.jsx(j,{children:"N°"}),e.jsx(j,{children:"Empresa"}),e.jsx(j,{children:"Descripción"}),e.jsx(j,{children:"Ingreso"}),e.jsx(j,{children:"Salida"}),e.jsx(j,{children:"Estado"}),e.jsx(j,{children:"Decisión"})]})}),e.jsx(ue,{children:I&&k&&k.data.map(h=>e.jsx(pe,{ctrl_id:r,registroTicket:h},h.rt_id))})]})}),I&&k&&e.jsx(he,{handleChangePage:d,handleChangeRowsPerPage:n,page:o,rowsPerPage:a,total:k.total_size})]})},_e=ie(ne)(({theme:r})=>({borderTopRightRadius:0,borderTopLeftRadius:0,border:"none",backgroundColor:r.palette.background.default,backgroundImage:"none",boxShadow:"none"})),Me=[{state:s.Esperando,name:"Pendiente",backgroundColor:"warning.300",filter:"drop-shadow(0px 2px 6px rgba(241, 225, 44, 0.30))"},{state:s.Aceptado,name:"Aceptado",backgroundColor:"success.opacityDarker",filter:"drop-shadow(0px 2px 6px rgba(44, 241, 120, 0.30))"},{state:s.Cancelado,name:"Cancelado",backgroundColor:"secondary.400",filter:"drop-shadow(0px 2px 6px rgba(242, 160, 44, 0.30))"},{state:s.Rechazado,name:"Rechazado",backgroundColor:"error.opacityDarker",filter:"drop-shadow(0px 2px 6px rgba(241, 44, 44, 0.30))"},{state:s.Finalizado,name:"Finalizado",backgroundColor:"info.opacityDarker",filter:"drop-shadow(0px 2px 6px rgba(44, 113, 241, 0.30))"},{state:s.Anulado,name:"Anulado",backgroundColor:"tertiary.opacityDarker",filter:"drop-shadow(0px 2px 6px rgba(93, 115, 117, 0.30))"},{state:s.NoAtendido,name:"No atendido",backgroundColor:"action.disabledBackground",filter:"drop-shadow(0px 1px 6px rgba(42, 55, 60, 0.10))"},{state:s.Asistido,name:"Asistió",backgroundColor:"primary.300",filter:"drop-shadow(0px 2px 6px rgba(44, 225, 241, 0.30))"},{state:s.Inasistencia,name:"No asistió",backgroundColor:"tertiary.opacityDarker",filter:"drop-shadow(0px 2px 6px rgba(93, 115, 117, 0.30))"}],C=({state:r})=>{const o=Me.find(l=>l.state===r);return e.jsxs(c,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(y,{sx:{width:12,height:12,backgroundColor:(o==null?void 0:o.backgroundColor)??"tertiary.opacityDarker",borderRadius:"50%",filter:(o==null?void 0:o.filter)??"drop-shadow(0px 2px 6px rgba(93, 115, 117, 0.30))",strokeWidth:1,stroke:"divider"}}),e.jsx(F,{color:"textSecondary",variant:"body1",children:(o==null?void 0:o.name)??"error_estado"})]})},Ie=()=>{const{rgn_id:r,ctrl_id:o}=D(n=>n.ticketStore),{isSuccess:l,data:a}=T(),[u,p]=b.useState(0),x=b.useMemo(()=>a===void 0?{}:w(a,"rgn_id"),[a]),f=b.useMemo(()=>{if(!a)return[];let n=a;return r!==void 0?n=n.filter(d=>String(d.rgn_id)===String(r)):u>0&&(n=n.filter(d=>String(d.rgn_id)===String(u))),o!==void 0&&(n=n.filter(d=>String(d.ctrl_id)===String(o))),n},[a,r,o,u]);return b.useEffect(()=>{if(l&&a&&r===void 0){const n=a[0].rgn_id;n&&p(n)}},[l,a,r]),e.jsxs(c,{spacing:2,height:"100%",children:[e.jsx(y,{children:e.jsx(L,{sx:{maxWidth:"100%",height:"100%"},children:e.jsx(c,{direction:"row",spacing:2,paddingBottom:1.5,children:Object.entries(x).map(([n,d])=>e.jsx(Ae,{region:d[0].region,selected:r!==void 0?String(r)===String(n):String(n)===String(u),onClick:()=>{p(Number(n))}},n))})})}),e.jsxs(c,{flexGrow:1,overflow:"hidden",sx:{borderWidth:1,borderStyle:"solid",borderColor:"divider",borderRadius:"8px"},children:[e.jsx(L,{sx:{height:"100%",width:"100%"},children:e.jsx(ge,{disablePadding:!0,children:f.map((n,d,v)=>e.jsx(Pe,{title:n.nodo,divider:d<v.length-1,children:e.jsx(Se,{controlador:n})},`${n.rgn_id}_${n.ctrl_id}`))})}),e.jsxs(c,{direction:"row",spacing:1,px:2,py:1,alignItems:"center",sx:{backgroundColor:"action.hover"},children:[e.jsx(C,{state:s.Esperando}),e.jsx(C,{state:s.Aceptado}),e.jsx(C,{state:s.Rechazado}),e.jsx(C,{state:s.Inasistencia}),e.jsx(C,{state:s.Finalizado}),e.jsx(C,{state:s.Cancelado}),e.jsx(C,{state:s.NoAtendido})]})]})]})},Ae=({region:r,selected:o,onClick:l})=>e.jsx(y,{sx:{py:1,px:2,borderRadius:"10px",border:"1px solid",borderColor:"custom.outlineBoder",":hover":{...o&&{backgroundColor:"primary.opacityDark"},...!o&&{backgroundColor:"primary.opacityLight"}},...o&&{backgroundColor:"primary.opacityDark",borderColor:"transparent"},cursor:"pointer"},onClick:l,children:e.jsx(F,{variant:"subtitle1",color:"textPrimary",sx:{whiteSpace:"nowrap"},children:r.region})}),Pe=({children:r,title:o,divider:l})=>{const[a,u]=b.useState(!1),p=()=>{u(!a)};return e.jsxs(e.Fragment,{children:[e.jsxs(ke,{onClick:p,sx:{backgroundColor:"tertiary.opacityMain",color:"text.primary",":hover":{color:"text.primary",backgroundColor:a?"tertiary.opacityMain":"custom.trackBackground"}},divider:l,children:[e.jsx(H,{primary:o,slotProps:{primary:{variant:"subtitle1"}}}),a?e.jsx(je,{}):e.jsx(Ce,{})]}),e.jsx(ye,{in:a,timeout:"auto",unmountOnExit:!0,sx:{...a&&{borderBottomWidth:1,borderBottomStyle:"solid",borderBottomColor:"divider"}},children:r})]})},Ne=()=>e.jsx(y,{sx:{width:"100%",height:"100%",overflow:"hidden"},children:e.jsxs(c,{sx:{px:{xs:2,sm:3},py:{xs:2,sm:3},mx:"auto",overflow:"hidden"},spacing:2,maxWidth:1600,width:"100%",height:"100%",children:[e.jsx(c,{children:e.jsx(F,{variant:"h5",children:"Tickets"})}),e.jsx(we,{}),e.jsx(xe,{}),e.jsx(c,{flexGrow:1,overflow:"hidden",children:e.jsx(Ie,{})})]})});export{Ne as default};
