import{aS as V,j as e,l as k,E as A,A as H,n as J,r as h,ec as K,bB as U,B as F,bC as X,bD as Y,T as p,bE as Z,p as I,ed as ee,d$ as w,ee as te,ef as N,ac as W,aJ as R,I as re,dL as ae,h as L,i as M,eg as se,at as ie,eh as ne,aF as oe}from"./index-B2MwQ28r.js";import{S as le,D as de,G as f,g as B,M as ce,P as ue}from"./SearchIcon-nGvQXR5y.js";import{E as xe}from"./EditIcon-Bx0s_9zJ.js";import{F as O,D as he,a as $,A as G}from"./DialogModel-CiYTiKbz.js";import{A as q}from"./Autocomplete-DO-HpUXO.js";import{C as P}from"./Card-Czpwx8nj.js";import"./usePreviousProps-DjccIP3f.js";const pe=({handleSearchChange:u,handleClearValue:l})=>{const[i,d]=V.useState(""),x=j=>{const g=j.target.value;d(g.trim()),u(g.trim())},m=()=>{d(""),l()};return e.jsx(k,{direction:"row",spacing:1,alignItems:"center",height:"auto",paddingBottom:1.5,children:e.jsx(k,{spacing:2,sx:{width:250},children:e.jsx(A,{value:i,onChange:x,placeholder:"Buscar empresa",fullWidth:!0,variant:"outlined",InputProps:{startAdornment:e.jsx(le,{}),endAdornment:i&&e.jsx(H,{onClick:m})},sx:{borderRadius:"25px","& .MuiOutlinedInput-root":{borderRadius:"25px",paddingRight:"10px"}}})})})},me=({onSearchChange:u,setRowsPerPage:l,setPage:i})=>{const d=()=>{l(10),i(0),u("")};return e.jsx(J,{sx:{width:"100%",height:"100%"},children:e.jsx(k,{direction:"row",spacing:1,alignItems:"center",height:"auto",paddingBottom:1.5,justifyContent:"space-between",children:e.jsx(pe,{handleSearchChange:u,handleClearValue:d})})})},ge=({openDialog:u,handleCloseDialog:l,name:i,id:d,onClose:x,lastName:m})=>{const[j,g]=h.useState(""),[n,b]=h.useState(""),[v,{isLoading:o}]=K(),c=async()=>{if(j===i)try{await v({id:d}),n||(x==null||x(),l())}catch(t){b(B(t))}else b("El nombre no coincide. Intenta de nuevo.")};return e.jsxs(U,{open:u,onClose:l,sx:{"& .MuiDialogPaper-root":{borderRadius:"24px !important"}},onClick:t=>t.stopPropagation(),children:[e.jsx(F,{display:"flex",justifyContent:"center",mt:2,children:e.jsx("img",{src:de,alt:"Eliminar icono",style:{width:48,height:48}})}),e.jsxs(X,{sx:t=>({...t.typography.h5,textAlign:"center",color:t.palette.text.primary}),children:["¿Estás seguro de eliminar la tarjeta ",i," ",m,"?"]}),e.jsxs(Y,{children:[e.jsx(p,{sx:t=>({...t.typography.body2,textAlign:"center",color:t.palette.text.secondary}),children:"Al eliminar, el personal ya no podrá hacer uso de su tarjeta para ingresar al sitio"}),e.jsxs(p,{sx:t=>({marginTop:2,color:t.palette.text.primary}),children:['Para confirmar, escribe: "',i,'"']}),e.jsx(A,{fullWidth:!0,margin:"dense",variant:"outlined",placeholder:"Escribe el nombre del personal",value:j,onChange:t=>{g(t.target.value),b("")},error:!!n,helperText:n}),n&&e.jsx(f,{item:!0,xs:12,children:e.jsx(p,{variant:"body2",sx:t=>({color:t.palette.error.light}),children:n})})]}),e.jsxs(Z,{children:[e.jsx(I,{onClick:l,color:"inherit",sx:{"&:hover":{backgroundColor:t=>t.palette.tertiary.opacityLighter}},children:"Cancelar"}),e.jsx(I,{onClick:c,color:"error",disabled:j!==i||o,variant:"contained",sx:{"&:hover":{backgroundColor:t=>t.palette.error.light},"&:disabled":{backgroundColor:t=>t.palette.action.disabledBackground}},children:"Eliminar"})]})]})},je=({onClose:u,id:l})=>{const[i,{isLoading:d}]=ee(),[x,m]=h.useState(""),[j,g]=h.useState(""),[n,b]=h.useState(null),{data:v,isLoading:o}=w(),{data:c}=te({id:l},{refetchOnMountOrArgChange:!0}),{data:t,isLoading:E}=N({name:j}),[s,_]=h.useState({serie:"",administrador:!1,p_id:0,ea_id:""}),[S,r]=h.useState({serie:"",ea_id:"",p_id:""}),C=a=>{m(""),_({...s,[a.target.name]:a.target.value}),r({...S,[a.target.name]:""})},D=()=>{const a={serie:"",administrador:"",ea_id:"",p_id:""};let y=!0;for(const T in s)T!=="administrador"&&!s[T]&&(a[T]="Este campo es obligatorio",y=!1);return(!s.serie||Number(s.serie)<=0)&&(a.serie="Debe ser un número mayor a 0",y=!1),r(a),y},z=async()=>{if(m(""),!!D())try{const a={serie:Number(s.serie),administrador:s.administrador===!0?1:0,p_id:Number(s.p_id),ea_id:Number(s.ea_id)};await i({id:l,data:a}).unwrap(),u()}catch(a){m(B(a))}};h.useEffect(()=>{if(c){_({serie:String(c.serie),administrador:c.administrador===1,p_id:c.p_id,ea_id:String(c.ea_id)});const a={p_id:c.p_id,nombre:c.nombre_personal,apellido:c.apellido};b(a),g(`${a.nombre}`)}},[c]);const Q=V.useMemo(()=>{var y;return n?((y=t==null?void 0:t.data)==null?void 0:y.some(T=>T.p_id===n.p_id))?t==null?void 0:t.data:[n,...(t==null?void 0:t.data)||[]]:(t==null?void 0:t.data)||[]},[t,n]);return e.jsxs(f,{container:!0,spacing:2,direction:"column",children:[e.jsxs(f,{item:!0,xs:8,children:[e.jsx(p,{sx:a=>({mt:2,mb:.5,color:a.palette.text.primary,fontWeight:500}),children:"Número*"}),e.jsx(A,{name:"serie",fullWidth:!0,value:s.serie,onChange:C,error:!!S.serie,helperText:S.serie})]}),e.jsxs(f,{item:!0,xs:8,children:[e.jsx(p,{sx:a=>({mt:2,mb:.5,color:a.palette.text.primary,fontWeight:500}),children:"Tipo*"}),e.jsx(A,{name:"ea_id",select:!0,fullWidth:!0,value:s.ea_id,onChange:C,error:!!S.ea_id,helperText:S.ea_id,children:v&&!o&&v.map(a=>e.jsx(W,{value:a.ea_id,children:a.nombre},a.ea_id))})]}),e.jsxs(f,{item:!0,xs:8,children:[e.jsx(p,{sx:a=>({mt:2,mb:.5,color:a.palette.text.primary,fontWeight:500}),children:"Personal asignado*"}),e.jsx(q,{options:Q||[],inputValue:j,value:n,onInputChange:(a,y)=>{g(y)},getOptionLabel:a=>`${a.nombre} ${a.apellido}`,onChange:(a,y)=>{b(y),r({...S,p_id:""}),_({...s,p_id:y?y.p_id:0})},loading:E,renderInput:a=>e.jsx(A,{...a,error:!!S.p_id,helperText:S.p_id,fullWidth:!0}),isOptionEqualToValue:(a,y)=>a.p_id===y.p_id})]}),e.jsx(f,{item:!0,xs:8,children:e.jsx(O,{control:e.jsx(R,{checked:s.administrador,onChange:a=>_({...s,administrador:a.target.checked})}),label:e.jsxs("div",{children:[e.jsx(p,{sx:{fontWeight:500},children:"Ingreso libre"}),e.jsx(p,{variant:"body2",color:"text.secondary",children:"El personal podrá ingresar al sitio libremente las veces que desee"})]})})}),x&&e.jsx(f,{item:!0,xs:12,children:e.jsx(p,{variant:"body2",sx:a=>({color:a.palette.error.light}),children:x})}),e.jsxs(f,{item:!0,xs:8,textAlign:"right",children:[e.jsx(I,{onClick:u,children:"Cancelar"}),e.jsx(I,{variant:"contained",sx:{ml:2},onClick:z,disabled:d,children:"Guardar cambios"})]})]})},be=({id:u,name:l,lastName:i})=>{const[d,x]=h.useState(null),[m,j]=h.useState(!1),[g,n]=h.useState(!1),b=s=>{x(s.currentTarget)},v=()=>{x(null)},o=()=>{j(!0),x(null)},c=()=>{j(!1)},t=()=>{n(!1),o()},E=()=>{n(!0),o()};return e.jsxs(e.Fragment,{children:[e.jsx(re,{onClick:s=>{s.stopPropagation(),b(s)},children:e.jsx(ce,{})}),e.jsxs(ae,{anchorEl:d,open:!!d,onClose:v,children:[e.jsxs(W,{onClick:s=>{s.stopPropagation(),E()},children:[e.jsx(L,{children:e.jsx(xe,{fontSize:"small"})}),e.jsx(M,{primary:"Editar"})]}),e.jsxs(W,{onClick:s=>{s.stopPropagation(),t()},children:[e.jsx(L,{children:e.jsx(he,{fontSize:"small"})}),e.jsx(M,{primary:"Eliminar"})]})]}),g&&m&&e.jsx($,{Title:"Editar acceso",openDialog:m,children:e.jsx(je,{id:u,onClose:c}),width:"xs",handleCloseDialog:c,actions:!1}),!g&&m&&e.jsx(ge,{handleCloseDialog:c,id:u,lastName:i,name:l,openDialog:m})]})},fe=({onClose:u})=>{const[l,{isLoading:i}]=se(),[d,x]=h.useState(""),[m,j]=h.useState(""),{data:g,isLoading:n}=w(),{data:b,isLoading:v}=N({name:m}),[o,c]=h.useState({serie:"",administrador:!1,p_id:0,ea_id:""}),[t,E]=h.useState({serie:"",ea_id:"",p_id:""}),s=r=>{x(""),c({...o,[r.target.name]:r.target.value}),E({...t,[r.target.name]:""})},_=()=>{const r={serie:"",administrador:"",ea_id:"",p_id:""};let C=!0;for(const D in o)D!=="administrador"&&!o[D]&&(r[D]="Este campo es obligatorio",C=!1);return(!o.serie||Number(o.serie)<=0)&&(r.serie="Debe ser un número mayor a 0",C=!1),E(r),C},S=async()=>{if(x(""),!!_())try{const r={serie:Number(o.serie),administrador:o.administrador===!0?1:0,p_id:Number(o.p_id),ea_id:Number(o.ea_id)};await l(r).unwrap(),u()}catch(r){x(B(r))}};return e.jsxs(f,{container:!0,spacing:2,direction:"column",children:[e.jsxs(f,{item:!0,xs:8,children:[e.jsx(p,{sx:r=>({mt:2,mb:.5,color:r.palette.text.primary,fontWeight:500}),children:"Número*"}),e.jsx(A,{name:"serie",fullWidth:!0,value:o.serie,onChange:s,error:!!t.serie,helperText:t.serie})]}),e.jsxs(f,{item:!0,xs:8,children:[e.jsx(p,{sx:r=>({mt:2,mb:.5,color:r.palette.text.primary,fontWeight:500}),children:"Tipo*"}),e.jsx(A,{name:"ea_id",select:!0,fullWidth:!0,value:o.ea_id,onChange:s,error:!!t.ea_id,helperText:t.ea_id,children:g&&!n&&g.map(r=>e.jsx(W,{value:r.ea_id,children:r.nombre},r.ea_id))})]}),e.jsxs(f,{item:!0,xs:8,children:[e.jsx(p,{sx:r=>({mt:2,mb:.5,color:r.palette.text.primary,fontWeight:500}),children:"Personal asignado*"}),e.jsx(q,{options:(b==null?void 0:b.data)||[],inputValue:m,onInputChange:(r,C)=>{j(C)},getOptionLabel:r=>`${r.nombre} ${r.apellido}`,onChange:(r,C)=>{E({...t,p_id:""}),c({...o,p_id:C?C.p_id:0})},loading:v,renderInput:r=>e.jsx(A,{...r,error:!!t.p_id,helperText:t.p_id,fullWidth:!0}),isOptionEqualToValue:(r,C)=>r.p_id===C.p_id})]}),e.jsx(f,{item:!0,xs:8,children:e.jsx(O,{control:e.jsx(R,{checked:o.administrador,onChange:r=>c({...o,administrador:r.target.checked})}),label:e.jsxs("div",{children:[e.jsx(p,{sx:{fontWeight:500},children:"Ingreso libre"}),e.jsx(p,{variant:"body2",color:"text.secondary",children:"El personal podrá ingresar al sitio libremente las veces que desee"})]})})}),d&&e.jsx(f,{item:!0,xs:12,children:e.jsx(p,{variant:"body2",sx:r=>({color:r.palette.error.light}),children:d})}),e.jsxs(f,{item:!0,xs:8,textAlign:"right",children:[e.jsx(I,{onClick:u,children:"Cancelar"}),e.jsx(I,{variant:"contained",sx:{ml:2},onClick:S,disabled:i,children:"Crear"})]})]})},ye=({handleChangePage:u,page:l,rowsPerPage:i,total:d,handleCreate:x})=>e.jsxs(k,{spacing:1,direction:"row",alignItems:"center",justifyContent:"space-between",sx:{backgroundColor:"action.hover",borderTopWidth:1,borderTopStyle:"solid",borderTopColor:"divider",borderEndStartRadius:12,borderEndEndRadius:12,paddingInline:2,paddingTop:.5,paddingBottom:.5},children:[e.jsxs(k,{spacing:1,direction:"row",alignItems:"center",children:[e.jsx(p,{color:"textPrimary",variant:"subtitle2",children:`${d>0?l*i+1:0} - ${(l+1)*i<d?(l+1)*i:d} de ${d}`}),e.jsx(ie,{count:d,onPageChange:u,rowsPerPage:i,page:l})]}),e.jsx(I,{variant:"contained",size:"small",startIcon:e.jsx(G,{}),sx:{minHeight:"32px",padding:"4px 20px",color:"text.button",display:"flex",alignItems:"center",justifyContent:"center"},onClick:x,children:"Crear"})]}),De=()=>{const[u,l]=h.useState(0),[i,d]=h.useState(10),[x,m]=h.useState(""),[j,g]=h.useState(!1),{data:n,isLoading:b,isError:v}=ne({limit:i,offset:u*i,serie:x}),o=()=>{g(!0)},c=()=>{g(!1)},t=(s,_)=>{l(_)},E=s=>{m(s),d(10),l(0)};return e.jsx(ue,{title:"Tarjetas",filter:e.jsx(me,{setPage:l,setRowsPerPage:d,onSearchChange:E}),children:e.jsxs(e.Fragment,{children:[e.jsxs(oe,{container:!0,spacing:2,sx:{padding:2},children:[n&&!b&&(n==null?void 0:n.data.map((s,_)=>e.jsxs(P,{sx:{borderRadius:2,boxShadow:1,height:124,width:252.8,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",px:1.5,py:1,position:"relative"},children:[e.jsx(F,{sx:{position:"absolute",top:8,right:8},children:e.jsx(be,{id:s.a_id,lastName:s.personal.apellido,name:s.personal.nombre})}),e.jsxs(p,{variant:"overline",color:"text.secondary",children:["N° ",_+1," - ",s.administrador===0?"Invitado":"Acceso libre"]}),e.jsxs(p,{variant:"subtitle2",fontWeight:500,color:"text.primary",textAlign:"center",children:[s.personal.nombre," ",s.personal.apellido]}),e.jsx(p,{variant:"caption",color:"text.secondary",children:s.serie})]},_))),e.jsx(P,{sx:{borderRadius:2,boxShadow:1,height:124,width:252.8,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",px:1.5,py:1,position:"relative"},onClick:o,children:e.jsx(G,{sx:{fontSize:40,color:"text.primary"}})})]}),!b&&!v&&e.jsx(ye,{handleChangePage:t,handleCreate:o,page:u,rowsPerPage:i,total:(n==null?void 0:n.meta.totalCount)||1}),e.jsx($,{Title:"Crear acceso",actions:!1,children:e.jsx(fe,{onClose:c}),handleCloseDialog:c,openDialog:j,width:"xs"})]})})};export{De as default};
